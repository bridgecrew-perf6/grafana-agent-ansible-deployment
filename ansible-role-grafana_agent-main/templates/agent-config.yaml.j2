server:
  log_level: ${GRAFANA_LOG_LEVEL:-info}
  log_format: json
  log_source_ips_enabled: true
  http_listen_port: ${GRAFANA_HTTP_LISTEN_PORT:-12345}
  grpc_listen_port: ${GRAFANA_GRPC_LISTEN_PORT:-12346}

metrics:
  wal_directory: /opt/grafana/agent/wal/grafana-agent-wal
  global:
    scrape_interval: 60s

traces:
  configs:
  - name: wwt-tempo
    remote_write:
    - endpoint: http://loki.aiops.wwtatc.local:4318
      insecure: true
      protocol: "http" # default is grpc
    receivers:
      otlp:
        protocols:
          grpc:
          http:

integrations:
  prometheus_remote_write:
   - url: http://grafana.aiops.wwtatc.local:9090/api/v1/write
  agent:
    enabled: true
    scrape_integration: true
    metric_relabel_configs:
      - source_labels: [__name__]
        regex: 'promhttp_metric_handler_requests_total|prometheus_tsdb_wal_page_flushes_total|prometheus_tsdb_wal_fsync_duration_seconds_sum|prometheus_tsdb_wal_fsync_duration_seconds_count|prometheus_tsdb_wal_fsync_duration_seconds|prometheus_tsdb_wal_completed_pages_total|prometheus_treecache_zookeeper_failures_total|prometheus_treecache_watcher_goroutines|prometheus_template_text_expansion_failures_total|prometheus_target_sync_length_seconds_sum|prometheus_target_sync_length_seconds_count|prometheus_target_sync_length_seconds|prometheus_target_scrapes_sample_out_of_order_total|prometheus_target_scrapes_sample_out_of_bounds_total|prometheus_target_scrapes_sample_duplicate_timestamp_total|prometheus_target_scrapes_exemplar_out_of_order_total|prometheus_target_scrapes_exceeded_sample_limit_total|prometheus_target_scrapes_exceeded_body_size_limit_total|prometheus_target_scrapes_cache_flush_forced_total|prometheus_target_scrape_pools_total|prometheus_target_scrape_pools_failed_total|prometheus_target_scrape_pool_targets|prometheus_target_scrape_pool_sync_total|prometheus_target_scrape_pool_reloads_total|prometheus_target_scrape_pool_reloads_failed_total|prometheus_target_scrape_pool_exceeded_target_limit_total|prometheus_target_scrape_pool_exceeded_label_limits_total|prometheus_target_metadata_cache_entries|prometheus_target_metadata_cache_bytes|prometheus_sd_kuma_fetch_skipped_updates_total|prometheus_sd_kuma_fetch_failures_total|prometheus_sd_kuma_fetch_duration_seconds_sum|prometheus_sd_kuma_fetch_duration_seconds_count|prometheus_sd_kuma_fetch_duration_seconds|prometheus_sd_kubernetes_events_total|prometheus_sd_file_scan_duration_seconds|prometheus_sd_file_scan_duration_seconds_sum|prometheus_sd_file_scan_duration_seconds_count|prometheus_sd_file_read_errors_total|prometheus_sd_dns_lookups_total|prometheus_sd_dns_lookup_failures_total|prometheus_sd_consulagent_rpc_failures_total|prometheus_sd_consulagent_rpc_duration_seconds|prometheus_sd_consulagent_rpc_duration_seconds_sum|prometheus_sd_consulagent_rpc_duration_seconds_count|prometheus_sd_consul_rpc_failures_total|prometheus_sd_consul_rpc_duration_seconds|prometheus_sd_consul_rpc_duration_seconds_sum|prometheus_sd_consul_rpc_duration_seconds_count|prometheus_remote_storage_shards_min|prometheus_remote_storage_shards_max|prometheus_remote_storage_shards_desired|prometheus_remote_storage_shard_capacity|prometheus_remote_storage_shards|prometheus_remote_storage_sent_batch_duration_seconds|prometheus_remote_storage_samples_total|prometheus_remote_storage_samples_retried_total|prometheus_remote_storage_metadata_total|prometheus_remote_storage_metadata_retried_total|prometheus_remote_storage_metadata_failed|prometheus_remote_storage_max_samples_per_send|prometheus_remote_storage_metadata_bytes_total|prometheus_remote_storage_metadata_failed_total|prometheus_remote_storage_exemplars_retried_total|prometheus_remote_storage_highest_timestamp_in_seconds|prometheus_remote_storage_exemplars_pending|prometheus_remote_storage_exemplars_in_total|prometheus_remote_storage_exemplars_failed|prometheus_remote_storage_exemplars_dropped_total|prometheus_remote_storage_enqueue_retries_total|prometheus_remote_storage_bytes_total|prometheus_remote_storage_bytes_total|prometheus_interner_string_interner_zero_reference_releases_total|prometheus_interner_num_strings|process_virtual_memory_bytes|process_start_time_seconds|process_resident_memory_bytes|process_open_fds|process_max_fds|net_conntrack_dialer_conn_established_total|loki_logql_querystats_ingester_sent_lines_total|net_conntrack_dialer_conn_failed_total|net_conntrack_dialer_conn_failed_total|net_conntrack_dialer_conn_established_total|loki_logql_querystats_duplicates_total|log_messages_total|go_memstats_stack_sys_bytes|go_memstats_sys_bytes|go_memstats_stack_inuse_bytes|go_memstats_other_sys_bytes|go_memstats_next_gc_bytes|go_memstats_mspan_sys_bytes|go_memstats_mspan_inuse_bytes|go_memstats_mcache_sys_bytes|go_memstats_mcache_inuse_bytes|go_memstats_mallocs_total|go_memstats_lookups_total|go_memstats_last_gc_time_seconds|go_memstats_heap_sys_bytes|go_memstats_heap_released|go_memstats_heap_objects|go_memstats_heap_inuse_bytes|go_memstats_heap_idle_bytes|go_memstats_heap_alloc_bytes|go_memstats_gc_sys_bytes|go_memstats_gc_cpu_fraction|go_memstats_frees_total|go_memstats_buck_hash_sys_bytes|go_memstats_alloc_bytes_total|go_memstats_alloc_bytes|go_gc_duration_seconds|go_gc_duration_seconds_sum|go_gc_duration_seconds_count|deprecated_flags_inuse_total|cortex_experimental_features_in_use_total|agent_wal_storage_removed_series_total|agent_wal_storage_deleted_series|agent_wal_storage_active_series|agent_wal_storage_created_series_total|agent_tcp_connections_limit|agent_wal_exemplars_appended_total|agent_wal_samples_appended_total|agent_tcp_connections|agent_response_message_bytes|agent_request_message_bytes|agent_request_duration_seconds|agent_metrics_ha_configs_updated_total|agent_metrics_ha_configs_deleted_total|agent_metrics_ha_configs_created_total|agent_metrics_configs_changed_total|agent_metrics_cleaner_success_total|agent_metrics_cleaner_managed_storage|agent_metrics_cleaner_errors_total|agent_metrics_cleaner_cleanup_seconds|agent_metrics_cleaner_abandoned_storage|agent_metrics_active_configs|agent_metrics_active_instances|agent_inflight_requests|go_info|agent_request_duration_seconds_bucket|agent_request_duration_seconds_bucket_sum|agent_request_duration_seconds_bucket_count|agent_request_message_bytes_bucket|agent_prometheus_cleaner_abandoned_storage|agent_prometheus_cleaner_cleanup_seconds_bucket|agent_prometheus_cleaner_errors_total|agent_prometheus_cleaner_managed_storage|agent_prometheus_cleaner_cleanup_seconds_sum|agent_prometheus_cleaner_cleanup_seconds_count'
        action: drop
  node_exporter:
    enabled: true
    scrape_integration: ${GRAFANA_NODE_EXPORTER_SCRAPE_ENABLE:-true}
    enable_collectors:
     - processes
     - systemd
    filesystem_ignored_mount_points: "^/(dev|proc|sys|run/user/.+|var/lib/docker/.+)($|/)"
    include_exporter_metrics: true

    metric_relabel_configs:
      - source_labels: [__name__]
        regex: 'node_systemd_unit_state|node_arp_entries|node_context_switches_total|node_cooling_device_cur_state|node_cooling_device_max_state|node_disk_io_now|node_disk_io_time_weighted_seconds_total|node_disk_reads_merged_total|node_disk_read_time_seconds_total|node_disk_writes_merged_total|node_disk_write_time_seconds_total|node_entropy_available_bits|node_filesystem_files|node_filesystem_files_free|node_forks_total|node_intr_total|node_memory_Active_anon_bytes|node_memory_Active_bytes|node_memory_Active_file_bytes|node_memory_AnonHugePages_bytes|node_memory_AnonPages_bytes|node_memory_Bounce_bytes|node_memory_Buffers_bytes|node_memory_Cached_bytes|node_memory_CmaFree_bytes|node_memory_CmaTotal_bytes|node_memory_Committed_AS_bytes|node_memory_DirectMap1G_bytes|node_memory_DirectMap2M_bytes|node_memory_DirectMap4k_bytes|node_memory_Dirty_bytes|node_memory_HardwareCorrupted_bytes|node_memory_HugePages_Free|node_memory_Hugepagesize_bytes|node_memory_HugePages_Rsvd|node_memory_HugePages_Surp|node_memory_HugePages_Total|node_memory_Inactive_anon_bytes|node_memory_Inactive_bytes|node_memory_Inactive_file_bytes|node_memory_KernelStack_bytes|node_memory_Mapped_bytes|node_memory_Mlocked_bytes|node_memory_NFS_Unstable_bytes|node_memory_PageTables_bytes|node_memory_Percpu_bytes|node_memory_Shmem_bytes|node_memory_Slab_bytes|node_memory_SReclaimable_bytes|node_memory_SUnreclaim_bytes|node_memory_Unevictable_bytes|node_memory_VmallocChunk_bytes|node_memory_VmallocTotal_bytes|node_memory_VmallocUsed_bytes|node_memory_Writeback_bytes|node_memory_WritebackTmp_bytes|node_netstat_Icmp6_InErrors|node_netstat_Icmp6_InMsgs|node_netstat_Icmp6_OutMsgs|node_netstat_Icmp_InErrors|node_netstat_Icmp_InMsgs|node_netstat_Icmp_OutMsgs|node_netstat_Ip6_InOctets|node_netstat_Ip6_OutOctets|node_netstat_IpExt_InOctets|node_netstat_IpExt_OutOctets|node_netstat_Ip_Forwarding|node_netstat_Tcp_ActiveOpens|node_netstat_Tcp_CurrEstab|node_netstat_TcpExt_ListenDrops|node_netstat_TcpExt_ListenOverflows|node_netstat_TcpExt_SyncookiesFailed|node_netstat_TcpExt_SyncookiesRecv|node_netstat_TcpExt_SyncookiesSent|node_netstat_TcpExt_TCPSynRetrans|node_netstat_Tcp_InErrs|node_netstat_Tcp_InSegs|node_netstat_Tcp_OutSegs|node_netstat_Tcp_PassiveOpens|node_netstat_Tcp_RetransSegs|node_netstat_Udp6_InDatagrams|node_netstat_Udp6_InErrors|node_netstat_Udp6_NoPorts|node_netstat_Udp6_OutDatagrams|node_netstat_Udp6_RcvbufErrors|node_netstat_Udp6_SndbufErrors|node_netstat_Udp_InDatagrams|node_netstat_Udp_InErrors|node_netstat_UdpLite6_InErrors|node_netstat_UdpLite_InErrors|node_netstat_Udp_NoPorts|node_netstat_Udp_OutDatagrams|node_netstat_Udp_RcvbufErrors|node_netstat_Udp_SndbufErrors|node_network_address_assign_type|node_network_carrier|node_network_carrier_changes_total|node_network_device_id|node_network_dormant|node_network_flags|node_network_iface_id|node_network_iface_link|node_network_iface_link_mode|node_network_info|node_network_mtu_bytes|node_network_net_dev_group|node_network_protocol_type|node_network_receive_bytes_total|node_network_receive_compressed_total|node_network_receive_drop_total|node_network_receive_errs_total|node_network_receive_fifo_total|node_network_receive_frame_total|node_network_receive_multicast_total|node_network_receive_packets_total|node_network_speed_bytes|node_network_transmit_bytes_total|node_network_transmit_carrier_total|node_network_transmit_colls_total|node_network_transmit_compressed_total|node_network_transmit_drop_total|node_network_transmit_errs_total|node_network_transmit_fifo_total|node_network_transmit_packets_total|node_network_transmit_queue_length|node_network_up|node_power_supply_info|node_power_supply_online|node_processes_state|node_sockstat_FRAG6_inuse|node_sockstat_FRAG6_memory|node_sockstat_FRAG_inuse|node_sockstat_FRAG_memory|node_sockstat_RAW6_inuse|node_sockstat_RAW_inuse|node_sockstat_sockets_used|node_sockstat_TCP6_inuse|node_sockstat_TCP_alloc|node_sockstat_TCP_inuse|node_sockstat_TCP_mem|node_sockstat_TCP_mem_bytes|node_sockstat_TCP_orphan|node_sockstat_TCP_tw|node_sockstat_UDP6_inuse|node_sockstat_UDP_inuse|node_sockstat_UDPLITE6_inuse|node_sockstat_UDPLITE_inuse|node_sockstat_UDP_mem|node_sockstat_UDP_mem_bytes|node_softnet_dropped_total|node_softnet_processed_total|node_softnet_times_squeezed_total|node_systemd_socket_accepted_connections_total|node_systemd_socket_current_connections|node_textfile_scrape_error|node_timex_estimated_error_seconds|node_timex_frequency_adjustment_ratio|node_timex_loop_time_constant|node_timex_maxerror_seconds|node_timex_offset_seconds|node_timex_pps_calibration_total|node_timex_pps_error_total|node_timex_pps_frequency_hertz|node_timex_pps_jitter_seconds|node_timex_pps_jitter_total|node_timex_pps_shift_seconds|node_timex_pps_stability_exceeded_total|node_timex_pps_stability_hertz|node_timex_status|node_timex_sync_status|node_timex_tai_offset_seconds|node_timex_tick_seconds|node_udp_queues|node_vmstat_pgfault|node_vmstat_pgmajfault|node_vmstat_pgpgin|node_vmstat_pgpgout|node_vmstat_pswpin|node_vmstat_pswpout'
        action: drop

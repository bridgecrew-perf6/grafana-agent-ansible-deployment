---
# ansible_architecture
grafana_agent_type:
  x86_64: amd64
  armv7l: armv7
  aarch64: arm64
promtail_type:
  x86_64: amd64
  armv7l: arm
  aarch64: arm64
#agent_location: /usr/local/bin
service_id: grafana-agent
service_gid: grafana-agent
agent_location: /opt/grafana/agent
config_location: /opt/grafana/agent
promtail_location: /opt/promtail
install_unzip: true
systemd_service_folder: /etc/systemd/system
grafana_location: us-central1
grafana_location_prometheus: "{{ grafana_location }}"
grafana_location_promtail: "{{ grafana_location }}"
grafana_agent_config_template: agent-config.yaml.j2
grafana_agent_systemd_template: grafana-agent.service.j2
grafana_promtail_config_template: promtail-config.yaml.j2
grafana_promtail_systemd_template: promtail.service.j2


process_exporter_config_part1:
  process_exporter:
    enabled: true
    metric_relabel_configs:
      - source_labels: [__name__]
        regex: 'namedprocess_namegroup_context_switches_total|namedprocess_namegroup_major_page_faults_total|namedprocess_namegroup_minor_page_faults_total|namedprocess_namegroup_oldest_start_time_seconds|namedprocess_namegroup_read_bytes_total|namedprocess_namegroup_thread_context_switches_total|namedprocess_namegroup_thread_io_bytes_total|namedprocess_namegroup_thread_major_page_faults_total|namedprocess_namegroup_thread_minor_page_faults_total|namedprocess_namegroup_threads_wchan|namedprocess_namegroup_worst_fd_ratio|namedprocess_namegroup_write_bytes_total'
        action: drop
      - source_labels: [state]
        regex: 'Sleeping|Waiting|Other'
        action: drop
    process_names:

process_exporter_config_part2:
  recheck_on_scrape: true
  scrape_integration: ${GRAFANA_PROCESS_EXPORTER_SCRAPE_ENABLE:-true}

log_config:
  logs:
    configs:
    - clients:
        - url: http://10.254.160.112:9090/api/v1/write
      name: promtail
      positions:
        filename: /tmp/positions.yaml
      scrape_configs:

ansible.aiops.wwtatc.local:
  - "grafana_monitoring"
  - "prometheus_monitoring"
  - "loki_monitoring"

proc_ansible.aiops.wwtatc.local:
  - "grafanaserver"
  - "prometheusserver"

open-telemetry.aiops.wwtatc.local:
  - "app111"

grafana.aiops.wwtatc.local:
  - "grafana_monitoring"

loki.aiops.wwtatc.local:
  - "loki_monitoring"

eshop.aiops.wwtatc.local:
  - "app111"

app_grafana_monitoring:
  - job_name: grafana-logs
    static_configs:
    - labels:
        __path__: /opt/grafana/logs/grafana/grafana.log
        application: grafana
        agent_hostname: ${HOSTNAME}
      targets:
      - ${HOSTNAME}

app_prometheus_monitoring:
  - job_name: prometheus-logs
    static_configs:
    - labels:
        __path__: /opt/grafana/logs/prometheus/prometheus.log
        application: prometheus
        agent_hostname: ${HOSTNAME}
      targets:
      - ${HOSTNAME}

app_loki_monitoring:
  - job_name: loki-logs
    static_configs:
    - labels:
        agent_hostname: ${HOSTNAME}
        __path__: /opt/grafana/logs/loki/loki.log
        application: loki
      targets:
      - ${HOSTNAME}

app_app111:
  - job_name: myapp111
    static_configs:
    - targets:
      - localhost
      labels:
        host: ${HOSTNAME}
        __path__: /opt/promtailtest/test6.log
        application: applogs

proc_grafanaserver:
  - cmdline:
    - /opt/grafana/grafana/bin/grafana-server
    name: grafana-server

proc_prometheusserver:
  - cmdline:
    - '/opt/grafana/prometheus/prometheus'
    name: prometheus

bp-hpe-rhel02.wwtpoc.local:
  - "app2"

bp-hpe-rhel06.wwtpoc.local:
  - "app6"

app_app2:
  - job_name: myapp2
    static_configs:
    - targets:
      - localhost
      labels:
        host: ${HOSTNAME}
        __path__: /opt/promtailtest/test2.log
        application: applogs

app_app6:
  - job_name: myapp6
    static_configs:
    - targets:
      - localhost
      labels:
        host: ${HOSTNAME}
        __path__: /opt/promtailtest/test6.log
        application: applogs
